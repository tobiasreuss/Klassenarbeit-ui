<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Klassenarbeit Korrektur</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --primary-color: #4a90e2;
      --accent-color: #50e3c2;
      --hero-bg: #e3f2fd;
      --bg-light: #f9f9f9;
      --text-dark: #333;
      --badge-bg: #ffeb3b;
      --badge-color: #333;
      --box-radius: 8px;
      --box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    * { box-sizing: border-box; }
    body {
      background: var(--hero-bg);
      color: var(--text-dark);
      font-family: 'Segoe UI', Tahoma, sans-serif;
      margin: 0;
      padding: 2rem;
      display: flex;
      justify-content: center;
    }
    .container {
      position: relative;
      background: #fff;
      padding: 2rem;
      border-radius: var(--box-radius);
      box-shadow: var(--box-shadow);
      width: 100%;
      max-width: 600px;
    }
    .badge {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: var(--badge-bg);
      color: var(--badge-color);
      padding: 0.25rem 0.5rem;
      border-radius: var(--box-radius);
      font-size: 0.875rem;
      font-weight: bold;
    }
    .hero-images {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    .hero-images img {
      width: 100%;
      height: auto;
      object-fit: cover;
      border-radius: var(--box-radius);
      box-shadow: var(--box-shadow);
    }
    h1 {
      margin-top: 0;
      color: var(--primary-color);
      text-align: center;
    }
    form {
      display: grid;
      gap: 1rem;
      margin-top: 1rem;
    }
    label { font-weight: bold; }
    input[type="file"], select, button {
      width: 100%; padding: 0.75rem; font-size: 1rem;
      border: 1px solid #ccc; border-radius: var(--box-radius);
    }
    button {
      background: var(--primary-color); color: #fff;
      border: none; cursor: pointer; transition: filter 0.3s;
    }
    button:hover { filter: brightness(0.9); }
    .results { margin-top: 2rem; }
    .box {
      padding: 1rem; border-radius: var(--box-radius);
      box-shadow: var(--box-shadow); margin-bottom: 1rem;
    }
    .streng { border-left: 6px solid #e74c3c; background: #fdecea; }
    .nachsichtig { border-left: 6px solid #27ae60; background: #e8f8f5; }
    pre {
      white-space: pre-wrap; word-wrap: break-word;
      background: #fafafa; padding: 0.5rem;
      border-radius: var(--box-radius); overflow-x: auto;
    }
    .spinner {
      border: 4px solid #f3f3f3; border-top: 4px solid var(--accent-color);
      border-radius: 50%; width: 2rem; height: 2rem;
      animation: spin 1s linear infinite; margin: 2rem auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="badge">Beta 0.1</div>
    <div class="hero-images">
      <img src="https://images.pexels.com/photos/4143794/pexels-photo-4143794.jpeg" alt="Fr√∂hliche Lehrerin mit Sch√ºlern" />
      <img src="https://images.pexels.com/photos/1181396/pexels-photo-1181396.jpeg" alt="Begeisterte Lehrerin motiviert Sch√ºler" />
      <img src="https://images.pexels.com/photos/5212358/pexels-photo-5212358.jpeg" alt="Lehrerin unterst√ºtzt Sch√ºler" />
      <img src="https://images.pexels.com/photos/5212782/pexels-photo-5212782.jpeg" alt="Lehrerin hilft Sch√ºlerin beim Schreiben" />
    </div>
    <h1>üìù Klassenarbeit Korrektur</h1>
    <form id="korrekturForm">
      <label>Klassenarbeit (Bild/PDF):
        <input type="file" name="data" accept="image/*,.pdf" required />
      </label>
      <label>Klassenstufe:</label>
      <select id="klasseSelect" name="klasse" required>
        <option value="">Bitte w√§hlen</option>
      </select>
      <label>Fach:</label>
      <select name="fach" required>
        <option value="">Bitte w√§hlen</option>
        <option value="Deutsch">Deutsch</option>
        <option value="Mathematik">Mathematik</option>
        <option value="Englisch">Englisch</option>
        <option value="Philosophie">Philosophie</option>
      </select>
      <label>Art der Aufgabe:</label>
      <select name="typ" required>
        <option value="">Bitte w√§hlen</option>
        <option value="Diktat">Diktat</option>
        <option value="Aufsatz">Aufsatz</option>
        <option value="Er√∂rterung">Er√∂rterung</option>
        <option value="Zusammenfassung">Zusammenfassung</option>
        <option value="Bericht">Bericht</option>
        <option value="Gedicht">Gedicht</option>
      </select>
      <button type="submit">Absenden & bewerten</button>
    </form>
    <div id="results" class="results"></div>
  </div>
  <script>
    // Dropdown-Klassenstufen bef√ºllen
    const klasseSel = document.getElementById('klasseSelect');
    for (let i = 1; i <= 13; i++) {
      const opt = document.createElement('option'); opt.value = i;
      opt.textContent = `Klasse ${i}`; klasseSel.appendChild(opt);
    }
    const form = document.getElementById('korrekturForm');
    const resultsDiv = document.getElementById('results');
    const WEBHOOK_URL = 'https://minerva.app.n8n.cloud/webhook/7199702a-7ff5-414a-ad0e-cb7919adecef';
    form.addEventListener('submit', async (e) => {
      e.preventDefault(); resultsDiv.innerHTML = '<div class="spinner"></div>';
      const formData = new FormData(form);
      formData.append('typ', formData.get('typ'));
      try {
        const resp = await fetch(WEBHOOK_URL, { method: 'POST', body: formData });
        if (!resp.ok) throw new Error(`Fehler ${resp.status}`);
        const wrapper = await resp.json();
        console.log('API raw:', wrapper);
        const content = wrapper.message?.content || wrapper.content;
        const parsed = JSON.parse(content);
        console.log('Parsed JSON:', parsed);
        const { streng = {}, nachsichtig = {} } = parsed;
        const noteS = streng.Note ?? streng.note ?? '‚Äì';
        const korrS = streng.Korrektur ?? streng.korrektur ?? '‚Äì';
        const noteN = nachsichtig.Note ?? nachsichtig.note ?? '‚Äì';
        const korrN = nachsichtig.Korrektur ?? nachsichtig.korrektur ?? '‚Äì';
        resultsDiv.innerHTML = `
          <div class="box streng">
            <h2>Strenge Bewertung (${formData.get('typ')})</h2>
            <p><strong>Note:</strong> ${noteS}</p>
            <pre>${korrS}</pre>
          </div>
          <div class="box nachsichtig">
            <h2>Nachsichtige Bewertung (${formData.get('typ')})</h2>
            <p><strong>Note:</strong> ${noteN}</p>
            <pre>${korrN}</pre>
          </div>
        `;
      } catch (err) {
        resultsDiv.innerHTML = `<p style="color:red">Fehler: ${err.message}</p>`;
        console.error(err);
      }
    });
  </script>
</body>
</html>
